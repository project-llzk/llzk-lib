// RUN: llzk-opt -split-input-file %s 2>&1 | FileCheck --enable-var-scope %s

function.def @new_empty_pod() -> !pod.type<[]> {
  %r = pod.new : <[]>
  function.return %r: !pod.type<[]>
}
//CHECK-LABEL:  function.def @new_empty_pod() -> !pod.type<[]> {
//CHECK-NEXT:     %[[T1:[0-9a-zA-Z_\.]+]] = pod.new : <[]>
//CHECK-NEXT:     function.return %[[T1]] : !pod.type<[]>
//CHECK-NEXT:   }

// -----

function.def @new_uninit_pod() -> !pod.type<[@n: index]> {
  %r = pod.new : <[@n: index]>
  function.return %r: !pod.type<[@n: index]>
}
//CHECK-LABEL:  function.def @new_uninit_pod() -> !pod.type<[@n: index]> {
//CHECK-NEXT:     %[[T1:[0-9a-zA-Z_\.]+]] = pod.new : <[@n: index]>
//CHECK-NEXT:     function.return %[[T1]] : !pod.type<[@n: index]>
//CHECK-NEXT:   }

// -----

!at = !array.type<affine_map<(i)[k] -> (5*i+k)>, affine_map<()[c] -> (c)>, affine_map<(j) -> (j+2)> x !felt.type>
function.def @new_uninit_pod() -> !pod.type<[@n: !at]> {
  %a = arith.constant 2 : index
  %b = arith.constant 4 : index
  %c = arith.constant 6 : index
  %d = arith.constant 1 : index
  %r = pod.new (%a)[%b], ()[%c], (%d) : <[@n: !at]>
  function.return %r: !pod.type<[@n: !at]>
}
// CHECK: #[[$M0:[0-9a-zA-Z_\.]+]] = affine_map<(d0)[s0] -> (d0 * 5 + s0)>
// CHECK: #[[$M1:[0-9a-zA-Z_\.]+]] = affine_map<()[s0] -> (s0)>
// CHECK: #[[$M2:[0-9a-zA-Z_\.]+]] = affine_map<(d0) -> (d0 + 2)>

//CHECK-LABEL:  function.def @new_uninit_pod() 
//CHECK-SAME:       -> !pod.type<[@n: !array.type<#[[$M0]],#[[$M1]],#[[$M2]] x !felt.type>]> {
//CHECK-NEXT:     %[[V0:[0-9a-zA-Z_\.]+]] = arith.constant 2 : index
//CHECK-NEXT:     %[[V1:[0-9a-zA-Z_\.]+]] = arith.constant 4 : index
//CHECK-NEXT:     %[[V2:[0-9a-zA-Z_\.]+]] = arith.constant 6 : index
//CHECK-NEXT:     %[[V3:[0-9a-zA-Z_\.]+]] = arith.constant 1 : index
//CHECK-NEXT:     %[[T1:[0-9a-zA-Z_\.]+]] = pod.new 
//CHECK-SAME:       (%[[V0]]){{\[}}%[[V1]]], (){{\[}}%[[V2]]], (%[[V3]]) :
//CHECK-SAME:       <[@n: !array.type<#[[$M0]],#[[$M1]],#[[$M2]] x !felt.type>]>
//CHECK-NEXT:     function.return %[[T1]] : !pod.type<[@n: !array.type<#[[$M0]],#[[$M1]],#[[$M2]] x !felt.type>]>
//CHECK-NEXT:   }

// -----

function.def @new_init_pod(%n: index) -> !pod.type<[@n: index]> {
  %r = pod.new { @n = %n } : <[@n: index]>
  function.return %r: !pod.type<[@n: index]>
}
//CHECK-LABEL:  function.def @new_init_pod(
//CHECK-SAME:       %[[A1:[0-9a-zA-Z_\.]+]]: index) -> !pod.type<[@n: index]> {
//CHECK-NEXT:     %[[T1:[0-9a-zA-Z_\.]+]] = pod.new { @n = %[[A1]] } : <[@n: index]>
//CHECK-NEXT:     function.return %[[T1]] : !pod.type<[@n: index]>
//CHECK-NEXT:   }

// -----

!at = !array.type<affine_map<(i)[k] -> (5*i+k)>, affine_map<()[c] -> (c)>, affine_map<(j) -> (j+2)> x !felt.type>
function.def @new_init_pod(%arr: !at) -> !pod.type<[@n: !at]> {
  %a = arith.constant 2 : index
  %b = arith.constant 4 : index
  %c = arith.constant 6 : index
  %d = arith.constant 1 : index
  %r = pod.new { @n = %arr } (%a)[%b], ()[%c], (%d) : <[@n: !at]>
  function.return %r: !pod.type<[@n: !at]>
}
// CHECK: #[[$M0:[0-9a-zA-Z_\.]+]] = affine_map<(d0)[s0] -> (d0 * 5 + s0)>
// CHECK: #[[$M1:[0-9a-zA-Z_\.]+]] = affine_map<()[s0] -> (s0)>
// CHECK: #[[$M2:[0-9a-zA-Z_\.]+]] = affine_map<(d0) -> (d0 + 2)>

//CHECK-LABEL:  function.def @new_init_pod(
//CHECK-SAME:       %[[A1:[0-9a-zA-Z_\.]+]]: !array.type<#[[$M0]],#[[$M1]],#[[$M2]] x !felt.type>) 
//CHECK-SAME:       -> !pod.type<[@n: !array.type<#[[$M0]],#[[$M1]],#[[$M2]] x !felt.type>]> {
//CHECK-NEXT:     %[[V0:[0-9a-zA-Z_\.]+]] = arith.constant 2 : index
//CHECK-NEXT:     %[[V1:[0-9a-zA-Z_\.]+]] = arith.constant 4 : index
//CHECK-NEXT:     %[[V2:[0-9a-zA-Z_\.]+]] = arith.constant 6 : index
//CHECK-NEXT:     %[[V3:[0-9a-zA-Z_\.]+]] = arith.constant 1 : index
//CHECK-NEXT:     %[[T1:[0-9a-zA-Z_\.]+]] = pod.new { @n = %[[A1]] }
//CHECK-SAME:       (%[[V0]]){{\[}}%[[V1]]], (){{\[}}%[[V2]]], (%[[V3]]) :
//CHECK-SAME:       <[@n: !array.type<#[[$M0]],#[[$M1]],#[[$M2]] x !felt.type>]>
//CHECK-NEXT:     function.return %[[T1]] : !pod.type<[@n: !array.type<#[[$M0]],#[[$M1]],#[[$M2]] x !felt.type>]>
//CHECK-NEXT:   }
